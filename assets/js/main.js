let DOM={get(e){return document.querySelector(e)},getAll(e){return document.querySelectorAll(e)}},CommonDOM={body:DOM.get("body"),switchMode:DOM.get("#headlessui-switch"),modalBackdrop:DOM.get("#modal-backdrop"),modalMain:DOM.get("#mdMain_modal"),videoIframe:DOM.get("#video-player")},VideoPlayer={player:null,getYouTubeVideoId:function(e){var t=e.match(/^https?:\/\/youtu\.be\/([^?&]+)/);return(t=(t=t||e.match(/[?&]v=([^?&]+)/))||e.match(/\/embed\/([^?&]+)/))?t[1]:null},loadYtbSrc:function(){var e=document.createElement("script"),t=(e.src="https://www.youtube.com/iframe_api",document.getElementsByTagName("script")[0]);t.parentNode.insertBefore(e,t)}};function GetClassCommon(i){if(Array.isArray(i)&&i.length){var e=i[0].split(" "),t=[];let o=[],a=[];return e.forEach(t=>{let a=!0;for(let e=1;e<i.length;e++)if(!i[e].split(" ").includes(t)){a=!1;break}a&&o.push(t)}),t.push(o.join(" ")),i.forEach(e=>{let t=[];e.split(" ").forEach(e=>{o.includes(e)||t.push(e)}),a.push(t.join(" "))}),t.push(a),t}}let App={init(){VideoPlayer.loadYtbSrc(),ModalManager.setupVideoBanner()}},ThemeManager={themeDark:"dark",themeLight:"light",init(){this.loadTheme(),CommonDOM.switchMode.addEventListener("click",this.toggleTheme.bind(this))},loadTheme(){"theme"in localStorage||!window.matchMedia("(prefers-color-scheme: dark)").matches||(localStorage.theme=this.themeDark);var e=localStorage.theme===this.themeDark;this.applyTheme(e)},toggleTheme(){localStorage.theme=localStorage.theme===this.themeDark?this.themeLight:this.themeDark,this.loadTheme()},applyTheme(e){var t=CommonDOM.switchMode;t.setAttribute("aria-checked",e),e?(t.classList.add("bg-slate-700","text-slate-400","focus-visible:ring-slate-500"),t.classList.remove("bg-blue-500","text-blue-200","focus-visible:ring-blue-600"),t.querySelectorAll("svg")[0].classList.add("scale-100","duration-300"),t.querySelectorAll("svg")[0].classList.remove("scale-0","duration-500"),t.querySelectorAll("svg")[1].classList.add("scale-0","duration-500"),t.querySelectorAll("svg")[1].classList.remove("scale-100","duration-300"),t.querySelectorAll("span")[1].classList.add("translate-x-[2.625rem]"),t.querySelectorAll("svg")[2].classList.add("opacity-0","scale-0"),t.querySelectorAll("svg")[2].classList.remove("opacity-100","scale-100"),t.querySelectorAll("svg")[3].classList.add("opacity-100","scale-100"),t.querySelectorAll("svg")[3].classList.remove("opacity-0","scale-0")):(t.classList.remove("bg-slate-700","text-slate-400","focus-visible:ring-slate-500"),t.classList.add("bg-blue-500","text-blue-200","focus-visible:ring-blue-600"),t.querySelectorAll("svg")[0].classList.remove("scale-100","duration-300"),t.querySelectorAll("svg")[0].classList.add("scale-0","duration-500"),t.querySelectorAll("svg")[1].classList.remove("scale-0","duration-500"),t.querySelectorAll("svg")[1].classList.add("scale-100","duration-300"),t.querySelectorAll("span")[1].classList.remove("translate-x-[2.625rem]"),t.querySelectorAll("svg")[2].classList.remove("opacity-0","scale-0"),t.querySelectorAll("svg")[2].classList.add("opacity-100","scale-100"),t.querySelectorAll("svg")[3].classList.remove("opacity-100","scale-100"),t.querySelectorAll("svg")[3].classList.add("opacity-0","scale-0")),t.querySelector("span.sr-only").innerText=`${e?"Disable":"Enable"} dark mode`,document.documentElement.classList.toggle("dark",e)}},ModalManager={modalClassList:{mobilemenu:[["px-6","max-w-sm"],["max-w-0"]],default:[["show"],["hidden-style"]],show:"show",hidden:"hidden-style"},dropdownClassList:{hidden:["max-h-0","opacity-0"],show:["max-h-max","mt-1","opacity-100"]},init(){this.setupModalButtons(),this.setupModalBackdrop(),this.setupDropdown(),this.setupModalSearch()},setupModalButtons(){DOM.getAll('[aria-modal-button="true"]').forEach(e=>{let t=e?.getAttribute("modal-button-name");t&&e.addEventListener("click",()=>{let i=this.openModal(t),s=e?.getAttribute("modal-function-name");if(s){let o=!1;i.querySelectorAll("form").forEach((e,t)=>{var a;o||e.getAttribute("name")==s&&(a=e.getAttribute("aria-setsize"),i.children[0].style.minWidth=a||"auto",e.parentElement.style.transform=`translateX(-${100*t}%)`,o=!0)})}})}),DOM.getAll('[id$="_modal"] .btn-close').forEach(t=>{t.addEventListener("click",()=>{var e=t.closest('[id$="_modal"]').id.replace(/_modal$/,"");this.closeModal(e)})}),document.addEventListener("keydown",e=>{"Escape"===e.key&&(e=DOM.getAll('[id$="_modal"].'+this.modalClassList.show)).length&&e.forEach(e=>{e=e.id.replace("_modal","");this.closeModal(e)})})},setupModalBackdrop(){CommonDOM.modalBackdrop.addEventListener("click",()=>{DOM.getAll('[id$="_modal"].'+this.modalClassList.show).forEach(e=>{var t=e.id.replace("_modal","");let a=this.modalClassList[t]??this.modalClassList.default;t=Array.from(e.classList).filter(e=>!a[0].includes(e)&&e!==this.modalClassList.show).concat(...a[1]);e.className=t.join(" ")}),CommonDOM.modalBackdrop.classList.add(this.modalClassList.hidden)})},setupDropdown(){DOM.getAll("[aria-expanded][aria-controls]").forEach(e=>{e.addEventListener("click",()=>{this.changeDropdown(e.getAttribute("aria-controls"))})}),document.onclick=e=>{e=e.target,e=this.getButtonDropdown(e);DOM.getAll('[aria-expanded="true"]'+(e?`:not([aria-controls="${e}"])`:"")).forEach(e=>{this.changeDropdown(e.getAttribute("aria-controls"),!1)})}},setupModalSearch(){document.addEventListener("keydown",e=>{if(e.ctrlKey&&"k"===e.key&&(e.preventDefault(),this.openModal("mdSearch")),-1<["ArrowUp","ArrowDown"].indexOf(e.key)&&"frmSearch"===document.activeElement?.id){var t=resultSearch.querySelectorAll("li");0==t.length&&(resultSearch.innerHTML='<li class="py-2">No results for "a1"</li>');let a=0,o=0,i=!1;t.forEach((e,t)=>{i||e.classList.contains("active")&&(o=t,a=t,i=!0)}),"ArrowUp"===e.key?a=0==a?t.length-1:a-1:"ArrowDown"===e.key&&(a=a==t.length-1?0:a+1),t[o].classList.remove("active"),t[a].classList.add("active"),resultSearch.parentElement.scrollTop=t[a].offsetTop-resultSearch.parentElement.clientHeight+t[a].clientHeight}})},openModal(e){var t=DOM.get(`#${e}_modal`);let a=this.modalClassList[e]??this.modalClassList.default;var o=Array.from(t.classList).filter(e=>!a[1].includes(e)).concat(...a[0],this.modalClassList.show);return t.className=o.join(" "),CommonDOM.modalBackdrop.classList.remove(this.modalClassList.hidden),document.body.classList.add("modal"),"mdSearch"===e&&frmSearch.focus(),t},closeModal(e){var t=DOM.get(`#${e}_modal`);let a=this.modalClassList[e]??this.modalClassList.default;e=Array.from(t.classList).filter(e=>!a[0].includes(e)&&e!==this.modalClassList.show).concat(a[1]);t.className=e.join(" "),CommonDOM.modalBackdrop.classList.add(this.modalClassList.hidden),document.body.classList.remove("modal")},getButtonDropdown(e){var t=e?.parentElement;return e&&e.hasAttribute("aria-controls")&&e.hasAttribute("aria-expanded")?e.getAttribute("aria-controls"):t&&t.hasAttribute("aria-controls")&&t.hasAttribute("aria-expanded")?t.getAttribute("aria-controls"):""},changeDropdown(e,t){var a=DOM.get(`[aria-controls="${e}"]`),t=t??!("true"==a.getAttribute("aria-expanded"));t?(DOM.get("#"+e).classList.remove(...this.dropdownClassList.hidden),DOM.get("#"+e).classList.add(...this.dropdownClassList.show)):(DOM.get("#"+e).classList.remove(...this.dropdownClassList.show),DOM.get("#"+e).classList.add(...this.dropdownClassList.hidden)),a.setAttribute("aria-expanded",t)},setupVideoBanner(){let e=DOM.get("[name=vdStart]");var t,a,o,i;e&&(o=`https://img.youtube.com/vi/${a=e.getAttribute("data-video-id")}/maxresdefault.jpg`,(t=DOM.get("#mainIframe")).setAttribute("data-video-id",a),t.innerHTML="",(a=document.createElement("img")).src=o,a.alt="YouTube Video Banner",a.classList.add("w-full","h-full","object-cover"),(o=document.createElement("div")).classList.add("absolute","inset-0","flex","items-center","justify-center","cursor-pointer"),(i=document.createElement("div")).classList.add("rounded-full","bg-red-600","bg-opacity-80","w-16","h-16","flex","items-center","justify-center","hover:bg-opacity-100","transition-all","duration-300","transform","hover:scale-110"),i.innerHTML=`
            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-white" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd" />
            </svg>
        `,o.addEventListener("click",()=>{e&&"function"==typeof e.click&&e.click()}),o.appendChild(i),t.appendChild(a),t.appendChild(o),t.style.position="relative")}};function setCookie(e,t,a,o=!0){var i=new Date,a=(i.setTime(i.getTime()+24*a*60*60*1e3),o?"secure;":"");document.cookie=`${e}=${encodeURIComponent(t)};expires=${i.toUTCString()};path=/;SameSite=Strict;`+a}function getCookie(e){var t,a=e+"=";for(t of document.cookie.split(";")){var o=t.trim();if(0===o.indexOf(a))return decodeURIComponent(o.substring(a.length))}return""}App.init(),document.addEventListener("DOMContentLoaded",function(){ThemeManager.init(),ModalManager.init()});let currentVideoPlayer=null;function openVideoModal(e){console.log("Opening video modal for:",e),CommonDOM.modalBackdrop.setAttribute("data-video-id",e),void 0!==ModalManager&&ModalManager.openModal("mdMain"),currentVideoPlayer=new YT.Player("video-player",{height:"100%",width:"100%",videoId:e,playerVars:{cc_load_policy:3,cc_lang_pref:"en",modestbranding:1},events:{onReady:onPlayerReady,onStateChange:onPlayerStateChange}})}function closeVideoModal(){console.log("Closing video modal"),exitMobileLandscape(),stopKaraokeWithSync(),currentVideoPlayer&&"function"==typeof currentVideoPlayer.destroy&&(currentVideoPlayer.destroy(),currentVideoPlayer=null),DOM.get("iframe#video-player")&&(DOM.get("iframe#video-player").outerHTML=CommonDOM.videoIframe.outerHTML),CommonDOM.modalBackdrop.removeAttribute("data-video-id")}function onPlayerReady(e){karaokeSystem.player=e.target;var t=CommonDOM.modalBackdrop.getAttribute("data-video-id"),t=(t&&loadCaptionsAndInitialize(t),e.target.playVideo(),e.target.getDuration());console.log("Thời lượng video:",t)}async function loadCaptionsAndInitialize(e){try{karaokeSystem.captionsData=await parseSBVFile(e),console.log("Loaded captions:",karaokeSystem.captionsData),0===karaokeSystem.captionsData.length&&clearTextLines()}catch(e){console.error("Failed to load captions:",e),karaokeSystem.captionsData=[],clearTextLines()}}let karaokeSystem={isRunning:!1,isPaused:!1,timeline:[],currentStep:0,timeouts:[],startTime:null,pausedTime:0,lastPauseTime:null,captionsData:[],player:null,syncInterval:null};async function parseSBVFile(e){try{var t=await(await fetch(`assets/captions/${e}.sbv`)).text();let i=[];var a=t.trim().split("\r\n\r\n");return a.forEach((e,t)=>{var a,o,e=e.trim().split("\r\n");2<=e.length&&(a=e[0],e=e.slice(1).filter(e=>""!==e.trim()),[a,o]=a.split(","),a=parseTimeString(a),o=parseTimeString(o),console.log(`Caption ${t}:`,{startTime:a,endTime:o,lines:e}),i.push({startTime:a,endTime:o,lines:e}))}),i}catch(e){return console.error("Error parsing SBV file:",e),[]}}function parseTimeString(e){var e=e.split(":"),t=parseInt(e[0]),a=parseInt(e[1]),e=e[2].split(".");return 3600*t+60*a+parseInt(e[0])+parseInt(e[1])/1e3}function onPlayerStateChange(e){e.data==YT.PlayerState.PLAYING?(console.log("Video đang chạy"),(karaokeSystem.isRunning?resumeKaraokeWithSync:initializeKaraokeWithSync)()):e.data==YT.PlayerState.PAUSED?(console.log("Video đã dừng/tạm dừng"),pauseKaraokeWithSync()):e.data==YT.PlayerState.ENDED&&(console.log("Video đã kết thúc"),stopKaraokeWithSync());e=e.target.getCurrentTime?e.target.getCurrentTime():0;console.log("Thời gian hiện tại:",e)}function renderLine(e,t){var a,o=document.getElementById(e);o.innerHTML="";for(a of t){var i=document.createElement("span");" "===a?i.innerHTML="&nbsp;":i.textContent=a,o.appendChild(i)}}function initializeKaraokeWithSync(){(0<karaokeSystem.captionsData.length?(console.log("Khởi tạo karaoke với SBV data:",karaokeSystem.captionsData.length,"captions"),karaokeSystem.currentStep=0,karaokeSystem.isRunning=!0,karaokeSystem.isPaused=!1,startVideoSync):(console.log("Không có dữ liệu caption để khởi tạo karaoke"),clearTextLines))()}function startVideoSync(){karaokeSystem.syncInterval&&clearInterval(karaokeSystem.syncInterval),karaokeSystem.syncInterval=setInterval(()=>{var e;karaokeSystem.isRunning&&!karaokeSystem.isPaused&&karaokeSystem.player&&(e=1e3*karaokeSystem.player.getCurrentTime(),0<karaokeSystem.captionsData.length?syncKaraokeWithVideo(e):clearTextLines())},100)}function syncKaraokeWithVideo(e){if(0!==karaokeSystem.captionsData.length){let t=e/1e3;e=karaokeSystem.captionsData.find(e=>t>=e.startTime&&t<=e.endTime);if(e){var o=karaokeSystem.captionsData.indexOf(e),o=karaokeSystem.captionsData[o+1],i=(t-e.startTime)/(e.endTime-e.startTime),s=document.getElementById("line1"),r=document.getElementById("line2"),n=e.lines[0]?e.lines[0].trim():"",e=e.lines[1]?e.lines[1].trim():"",l=o&&o.lines[0]?o.lines[0].trim():"",o=o&&o.lines[1]?o.lines[1].trim():"",d=n.length+e.length,d=0<d?n.length/d:.5;if(i<=d){s.textContent!==n&&renderLine("line1",n),r.textContent!==e&&renderLine("line2",e);var c=i/d;let a=Math.floor(c*n.length);s.querySelectorAll("span").forEach((e,t)=>{t<=a?e.classList.add("animated"):e.classList.remove("animated")}),r.querySelectorAll("span").forEach(e=>e.classList.remove("animated")),.95<=c&&l&&s.textContent!==l&&(renderLine("line1",l),s.querySelectorAll("span").forEach(e=>e.classList.remove("animated")))}else{l&&s.textContent!==l?(renderLine("line1",l),s.querySelectorAll("span").forEach(e=>e.classList.remove("animated"))):l||s.querySelectorAll("span").forEach(e=>e.classList.add("animated")),r.textContent!==e&&renderLine("line2",e);n=(i-d)/(1-d);let a=Math.floor(n*e.length);r.querySelectorAll("span").forEach((e,t)=>{t<=a?e.classList.add("animated"):e.classList.remove("animated")}),.95<=n&&o&&r.textContent!==o&&(renderLine("line2",o),r.querySelectorAll("span").forEach(e=>e.classList.remove("animated")))}}else{c=karaokeSystem.captionsData.find(e=>t<e.startTime);c&&c.startTime-t<=1?(l=document.getElementById("line1"),s=document.getElementById("line2"),i=c.lines[0]?c.lines[0].trim():"",d=c.lines[1]?c.lines[1].trim():"",i&&l.textContent!==i&&(renderLine("line1",i),l.querySelectorAll("span").forEach(e=>e.classList.remove("animated"))),d&&s.textContent!==d&&(renderLine("line2",d),s.querySelectorAll("span").forEach(e=>e.classList.remove("animated")))):clearTextLines()}}}function clearTextLines(){DOM.get("#line1").innerHTML="...",DOM.get("#line2").innerHTML=""}function pauseKaraokeWithSync(){karaokeSystem.isPaused=!0,karaokeSystem.syncInterval&&(clearInterval(karaokeSystem.syncInterval),karaokeSystem.syncInterval=null)}function resumeKaraokeWithSync(){karaokeSystem.isPaused=!1,startVideoSync()}function stopKaraokeWithSync(){karaokeSystem.isRunning=!1,karaokeSystem.isPaused=!1,karaokeSystem.syncInterval&&(clearInterval(karaokeSystem.syncInterval),karaokeSystem.syncInterval=null),DOM.getAll("#line1 span, #line2 span").forEach(e=>e.remove()),karaokeSystem.currentStep=0}let isLandscapeMode=!1;function toggleMobileLandscape(){var e=DOM.get("#rotateScreenBtn");isLandscapeMode?exitMobileLandscape():(document.body.classList.add("mobile-landscape-body"),document.documentElement.classList.add("mobile-landscape-mode"),isLandscapeMode=!0,e&&(e.innerHTML=`
        <svg class="w-6 h-6 mb-1" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
          <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M12 2V7M12 17V22M22 12H17M7 12H2M19.07 4.93L16.24 7.76M7.76 16.24L4.93 19.07M4.93 4.93L7.76 7.76M16.24 16.24L19.07 19.07" />
        </svg>
        <span class="text-xs font-semibold">Dọc</span>
      `))}function exitMobileLandscape(){var e=DOM.get("#rotateScreenBtn");document.body.classList.remove("mobile-landscape-body"),document.documentElement.classList.remove("mobile-landscape-mode"),isLandscapeMode=!1,e&&(e.innerHTML=`
      <svg class="w-6 h-6 mb-1" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
          d="M12 2V7M12 17V22M22 12H17M7 12H2M19.07 4.93L16.24 7.76M7.76 16.24L4.93 19.07M4.93 4.93L7.76 7.76M16.24 16.24L19.07 19.07" />
        </svg>
        <span class="text-xs font-semibold">Xoay</span>
      `)}document.addEventListener("DOMContentLoaded",function(){var e=DOM.get("#rotateScreenBtn");e&&e.addEventListener("click",toggleMobileLandscape),document.addEventListener("click",function(e){var e=e.target.closest("[data-video-id]");e&&(e=e.getAttribute("data-video-id"))&&openVideoModal(e)}),DOM.getAll('[id$="_modal"] .btn-close').forEach(e=>{e.addEventListener("click",()=>{!CommonDOM.modalMain||CommonDOM.modalMain.classList.contains(ModalManager.modalClassList.hidden)&&!CommonDOM.modalBackdrop.getAttribute("data-video-id")||closeVideoModal()})}),document.addEventListener("keydown",function(e){"Escape"!==e.key||!CommonDOM.modalMain||CommonDOM.modalMain.classList.contains(ModalManager.modalClassList.hidden)&&!CommonDOM.modalBackdrop.getAttribute("data-video-id")||closeVideoModal()})});let TailwindCarousel={init(r,n={}){let l={autoplay:!1,autoplaySpeed:3e3,dots:!0,arrows:!0,infinite:!0,...n},d=document.querySelector(r);if(d){let e=d.querySelector("[data-carousel-slides]");let t=d.querySelectorAll("[data-carousel-slide]").length,a=0,o=null;if(l.dots){var c=document.createElement("div");c.className="flex justify-center mt-4 space-x-2";for(let e=0;e<t;e++){var u=document.createElement("button");u.className="w-3 h-3 rounded-full bg-gray-300 dark:bg-gray-600 transition-colors",u.dataset.carouselDot=e,u.addEventListener("click",()=>m(e)),c.appendChild(u)}d.appendChild(c)}l.arrows&&((n=document.createElement("button")).className="absolute left-2 top-1/2 -translate-y-1/2 bg-white/80 dark:bg-gray-800/80 rounded-full p-2 z-10",n.innerHTML='<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>',n.addEventListener("click",()=>m(a-1)),(r=document.createElement("button")).className="absolute right-2 top-1/2 -translate-y-1/2 bg-white/80 dark:bg-gray-800/80 rounded-full p-2 z-10",r.innerHTML='<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>',r.addEventListener("click",()=>m(a+1)),d.appendChild(n),d.appendChild(r)),h(),g(),d.addEventListener("mouseenter",function(){o&&clearInterval(o)}),d.addEventListener("mouseleave",g);let i=0,s;return d.addEventListener("touchstart",e=>{i=e.changedTouches[0].screenX}),d.addEventListener("touchend",e=>{(s=e.changedTouches[0].screenX)<i-50?m(a+1):s>i+50&&m(a-1)}),{goToSlide:m,next:()=>m(a+1),prev:()=>m(a-1),getCurrentSlide:()=>a};function m(e){e<0?e=l.infinite?t-1:0:e>=t&&(e=l.infinite?0:t-1),a=e,h()}function h(){e.style.transform=`translateX(-${100*a}%)`,l.dots&&d.querySelectorAll("[data-carousel-dot]").forEach((e,t)=>{t===a?(e.classList.add("bg-blue-600","dark:bg-blue-500"),e.classList.remove("bg-gray-300","dark:bg-gray-600")):(e.classList.remove("bg-blue-600","dark:bg-blue-500"),e.classList.add("bg-gray-300","dark:bg-gray-600"))})}function g(){l.autoplay&&(o=setInterval(()=>{m(a+1)},l.autoplaySpeed))}}}};document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll("[data-carousel]").forEach(e=>{var t={autoplay:"true"===e.dataset.carouselAutoplay,autoplaySpeed:parseInt(e.dataset.carouselAutoplaySpeed||"3000"),dots:"false"!==e.dataset.carouselDots,arrows:"false"!==e.dataset.carouselArrows,infinite:"false"!==e.dataset.carouselInfinite};TailwindCarousel.init("#"+e.id,t)})});class CategoryPage{constructor(){this.currentCategory="pop",this.currentPage=1,this.itemsPerPage=8,this.allVideos=[],this.filteredVideos=[],this.isLoading=!1,this.filters={search:"",difficulty:"",sort:"popular",duration:[]},this.init()}init(){this.loadCategoryFromURL(),this.setupEventListeners(),this.loadVideos(),this.setupAnimations()}loadCategoryFromURL(){var e=new URLSearchParams(window.location.search);this.currentCategory=e.get("category")||"pop",this.updateCategoryInfo()}updateCategoryInfo(){var e={pop:{title:"Pop Hits",description:"Discover the latest pop songs with simple lyrics perfect for English learning"},classic:{title:"Classic Songs",description:"Timeless melodies that have shaped music history and perfect for language learning"},easy:{title:"Easy Listening",description:"Gentle, slow-paced songs ideal for beginners to follow along and learn"},soundtrack:{title:"Movie Soundtracks",description:"Iconic songs from your favorite movies and TV shows"}},e=e[this.currentCategory]||e.pop;document.getElementById("category-title").textContent=e.title,document.getElementById("category-description").textContent=e.description}setupEventListeners(){var e=document.getElementById("search-input");let t;e.addEventListener("input",e=>{clearTimeout(t),t=setTimeout(()=>{this.filters.search=e.target.value.toLowerCase(),this.filterVideos()},300)}),document.querySelectorAll('input[name="difficulty"]').forEach(e=>{e.addEventListener("change",e=>{this.filters.difficulty=e.target.value,this.filterVideos()})}),document.getElementById("sort-filter").addEventListener("change",e=>{this.filters.sort=e.target.value,this.filterVideos()}),document.querySelectorAll('input[type="checkbox"]').forEach((e,t)=>{e.addEventListener("change",()=>{this.updateDurationFilters(),this.filterVideos()})}),document.getElementById("load-more-btn").addEventListener("click",()=>{this.loadMoreVideos()})}updateDurationFilters(){var e=document.querySelectorAll('input[type="checkbox"]');this.filters.duration=[],e[0].checked&&this.filters.duration.push("short"),e[1].checked&&this.filters.duration.push("medium"),e[2].checked&&this.filters.duration.push("long")}async loadVideos(){this.showLoadingSkeleton(),await this.delay(1e3),this.allVideos=this.generateMockVideos(),this.filteredVideos=[...this.allVideos],this.hideLoadingSkeleton(),this.renderVideos(),this.animateCounters()}generateMockVideos(){return[{id:"kudi8OtMu9s",title:"Perfect - Ed Sheeran",artist:"Ed Sheeran",duration:"4:23",difficulty:"beginner",learners:"12.5K",rating:4.8,tags:["Love Songs","Basic Vocabulary"],thumbnail:"https://img.youtube.com/vi/2Vv-BfVoq4g/maxresdefault.jpg",views:"2.1M"},{id:"JGwWNGJdvx8",title:"Shape of You - Ed Sheeran",artist:"Ed Sheeran",duration:"3:53",difficulty:"intermediate",learners:"15.2K",rating:4.7,tags:["Pop","Daily Phrases"],thumbnail:"https://img.youtube.com/vi/JGwWNGJdvx8/maxresdefault.jpg",views:"5.8M"},{id:"hLQl3WQQoQ0",title:"Someone Like You - Adele",artist:"Adele",duration:"4:45",difficulty:"advanced",learners:"10.1K",rating:4.9,tags:["Ballad","Emotional Vocab"],thumbnail:"https://img.youtube.com/vi/hLQl3WQQoQ0/maxresdefault.jpg",views:"3.2M"},...this.generateAdditionalMockVideos()]}generateAdditionalMockVideos(){var t=[],a=["Thinking Out Loud - Ed Sheeran","Hello - Adele","Despacito - Luis Fonsi","Closer - The Chainsmokers","Let It Go - Frozen","Can't Stop the Feeling - Justin Timberlake","Havana - Camila Cabello","Shallow - Lady Gaga","Sunflower - Post Malone","Blinding Lights - The Weeknd","Watermelon Sugar - Harry Styles","Levitating - Dua Lipa"],o=["Ed Sheeran","Adele","Taylor Swift","The Weeknd","Dua Lipa","Harry Styles"],i=["beginner","intermediate","advanced"];for(let e=0;e<a.length;e++)t.push({id:"video_"+(e+4),title:a[e],artist:o[Math.floor(Math.random()*o.length)],duration:Math.floor(3*Math.random()+3)+":"+Math.floor(60*Math.random()).toString().padStart(2,"0"),difficulty:i[Math.floor(Math.random()*i.length)],learners:(20*Math.random()+5).toFixed(1)+"K",rating:(+Math.random()+4).toFixed(1),tags:["Pop","Modern"],thumbnail:`https://img.youtube.com/vi/${this.generateRandomVideoId()}/maxresdefault.jpg`,views:(5*Math.random()+1).toFixed(1)+"M"});return t}generateRandomVideoId(){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_";let a="";for(let e=0;e<11;e++)a+=t.charAt(Math.floor(Math.random()*t.length));return a}filterVideos(){let{search:o,difficulty:i,sort:e,duration:s}=this.filters;this.filteredVideos=this.allVideos.filter(e=>{var t=e.title.toLowerCase().includes(o)||e.artist.toLowerCase().includes(o),a=!i||e.difficulty===i,e=this.matchesDurationFilter(e.duration,s);return t&&a&&e}),this.sortVideos(e),this.currentPage=1,this.renderVideos(),this.updateStatsCounters()}updateStatsCounters(){var e=document.querySelector('[data-count="24"]'),t=document.querySelector('[data-count="1.2"]'),a=document.querySelector('[data-count="8.5"]'),e=(e&&(e.textContent=this.filteredVideos.length),this.filteredVideos.reduce((e,t)=>e+this.parseDuration(t.duration),0)),e=(e/3600).toFixed(1);t&&(t.textContent=e),0<this.filteredVideos.length&&(t=(this.filteredVideos.reduce((e,t)=>e+parseFloat(t.rating),0)/this.filteredVideos.length).toFixed(1),a)&&(a.textContent=t)}matchesDurationFilter(e,t){return 0===t.length||(e=this.parseDuration(e)/60,!!(t.includes("short")&&e<3))||!!(t.includes("medium")&&3<=e&&e<=5)||!!(t.includes("long")&&5<e)}sortVideos(e){switch(e){case"newest":this.filteredVideos.reverse();break;case"duration":this.filteredVideos.sort((e,t)=>this.parseDuration(e.duration)-this.parseDuration(t.duration));break;case"title":this.filteredVideos.sort((e,t)=>e.title.localeCompare(t.title));break;default:this.filteredVideos.sort((e,t)=>{e=parseFloat(e.learners.replace("K",""));return parseFloat(t.learners.replace("K",""))-e})}}parseDuration(e){e=e.split(":");return 60*parseInt(e[0])+parseInt(e[1])}renderVideos(){let a=document.getElementById("videos-grid");var e=this.currentPage*this.itemsPerPage,t=this.filteredVideos.slice(0,e),t=(a.innerHTML="",t.forEach((e,t)=>{e=this.createVideoCard(e,t);a.appendChild(e)}),document.getElementById("load-more-btn"));e>=this.filteredVideos.length?t.style.display="none":t.style.display="block",this.animateVideoCards()}createVideoCard(e,t){var a=document.createElement("div");a.className="video-card group bg-white dark:bg-gray-800 rounded-2xl overflow-hidden shadow-lg hover:shadow-2xl transform hover:-translate-y-2 transition-all duration-500",a.setAttribute("data-video-id",e.id),a.style.animationDelay=100*t+"ms";return a.innerHTML=`
            <div class="relative overflow-hidden">
                <img src="${e.thumbnail}" alt="${e.title}" 
                     class="w-full h-48 object-cover transform group-hover:scale-110 transition-transform duration-700"
                     onerror="this.src='https://via.placeholder.com/400x300/6366f1/white?text=Video+Thumbnail'">
                
                <!-- Difficulty Badge -->
                <span class="absolute top-3 right-3 px-3 py-1 ${{beginner:"bg-green-500",intermediate:"bg-yellow-500",advanced:"bg-red-500"}[e.difficulty]} text-white text-sm font-medium rounded-full capitalize">
                    ${e.difficulty}
                </span>
                
                <!-- Duration Badge -->
                <span class="absolute bottom-3 right-3 px-2 py-1 bg-black bg-opacity-70 text-white text-sm rounded">
                    ${e.duration}
                </span>
                
                <!-- Play Button Overlay -->
                <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 flex items-center justify-center transition-all duration-300">
                    <div class="transform scale-0 group-hover:scale-100 transition-transform duration-300">
                        <div class="w-16 h-16 bg-white bg-opacity-90 rounded-full flex items-center justify-center">
                            <svg class="w-8 h-8 text-blue-600 ml-1" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="p-6">
                <h3 class="font-bold text-lg mb-2 text-gray-900 dark:text-white group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors duration-300 line-clamp-2">
                    ${e.title}
                </h3>
                
                <p class="text-gray-600 dark:text-gray-400 mb-4">
                    ${e.artist}
                </p>
                
                <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center text-sm text-gray-500">
                        <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
                        </svg>
                        ${e.rating}
                    </div>
                    
                    <div class="flex items-center text-sm text-gray-500">
                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                        </svg>
                        ${e.views}
                    </div>
                </div>
                
                <div class="flex flex-wrap gap-2 mb-4">
                    ${e.tags.map(e=>`
                        <span class="px-2 py-1 bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200 rounded-lg text-xs">
                            ${e}
                        </span>
                    `).join("")}
                </div>
                
                <div class="flex items-center justify-between">
                    <span class="text-sm text-gray-500">
                        <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                        </svg>
                        ${e.learners} learners
                    </span>
                    
                    <button class="text-gray-400 hover:text-red-500 transition-colors duration-300">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                        </svg>
                    </button>
                </div>
            </div>
        `,a.addEventListener("click",()=>{this.playVideo(e.id)}),a}showLoadingSkeleton(){var t=document.getElementById("loading-skeleton");t.innerHTML="";for(let e=0;e<8;e++){var a=document.createElement("div");a.className="animate-pulse bg-white dark:bg-gray-800 rounded-2xl overflow-hidden shadow-lg",a.innerHTML=`
                <div class="bg-gray-300 dark:bg-gray-700 h-48"></div>
                <div class="p-6">
                    <div class="h-4 bg-gray-300 dark:bg-gray-700 rounded mb-2"></div>
                    <div class="h-4 bg-gray-300 dark:bg-gray-700 rounded w-3/4 mb-4"></div>
                    <div class="h-3 bg-gray-300 dark:bg-gray-700 rounded w-1/2"></div>
                </div>
            `,t.appendChild(a)}t.style.display="grid"}hideLoadingSkeleton(){document.getElementById("loading-skeleton").style.display="none"}loadMoreVideos(){if(!this.isLoading){this.isLoading=!0,this.currentPage++;let e=document.getElementById("load-more-btn"),t=e.innerHTML;e.innerHTML=`
            <span class="flex items-center">
                <svg class="animate-spin w-5 h-5 mr-2" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                Loading...
            </span>
        `,setTimeout(()=>{this.renderVideos(),e.innerHTML=t,this.isLoading=!1},800)}}animateVideoCards(){var e=document.querySelectorAll(".video-card");let t=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&(e.target.style.opacity="0",e.target.style.transform="translateY(30px)",e.target.style.transition="all 0.6s ease-out",setTimeout(()=>{e.target.style.opacity="1",e.target.style.transform="translateY(0)"},100),t.unobserve(e.target))})},{threshold:.1});e.forEach(e=>t.observe(e))}animateCounters(){document.querySelectorAll("[data-count]").forEach(e=>{let t=parseFloat(e.getAttribute("data-count")),a=t/100,o=0,i=setInterval(()=>{(o+=a)>=t&&(o=t,clearInterval(i)),1<=t?e.textContent=Math.floor(o):e.textContent=o.toFixed(1)},20)})}setupAnimations(){var e=document.createElement("style");e.textContent=`
            @keyframes float {
                0%, 100% { transform: translateY(0px); }
                50% { transform: translateY(-20px); }
            }
            
            @keyframes float-delayed {
                0%, 100% { transform: translateY(0px); }
                50% { transform: translateY(-15px); }
            }
            
            @keyframes fade-in-up {
                from {
                    opacity: 0;
                    transform: translateY(30px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }
            
            .animate-float {
                animation: float 3s ease-in-out infinite;
            }
            
            .animate-float-delayed {
                animation: float-delayed 3s ease-in-out infinite 1.5s;
            }
            
            .animate-fade-in-up {
                animation: fade-in-up 0.8s ease-out;
            }
            
            .line-clamp-2 {
                display: -webkit-box;
                -webkit-line-clamp: 2;
                -webkit-box-orient: vertical;
                overflow: hidden;
            }
        `,document.head.appendChild(e)}playVideo(e){void 0!==CommonDOM&&CommonDOM.modalBackdrop&&(CommonDOM.modalBackdrop.setAttribute("data-video-id",e),void 0!==ModalManager)&&ModalManager.openModal("mdMain")}delay(t){return new Promise(e=>setTimeout(e,t))}}document.addEventListener("DOMContentLoaded",()=>{document.getElementById("videos-grid")&&new CategoryPage}),document.addEventListener("DOMContentLoaded",function(){new WOW({boxClass:"wow",animateClass:"animated",offset:100,mobile:!0,live:!0,callback:function(e){},scrollContainer:null}).init()});
